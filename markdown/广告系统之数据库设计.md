# 广告系统之数据库设计
### 表设计

表 | 说明
------- | -------
position | 广告位表
advertiser|广告信息表
region|地区表，维护区域表，防止重名
ad_channle_region|广告渠道地区关联表
advertiser_pool|广告池
advertiser_pool_ad|广告池广告关联表
ad_stat|统计

#### 获取一个广告位下的广告：
1. 根据平台、渠道、地区、位置过滤`ad_channle_region`；
4. 过滤`advertiser`中有效的广告；
5. 地区需要考虑命中率，市级>省级>全国；


#### 广告管理（一般投放）
1. 每个位置维护一个广告列表，按照区域排序，顺序为全国>省级>市级；
2. 广告投放是有限制的，一个广告位（位置）下只能有一个相同渠道和相同区域的广告；
3. 一般投放新增的广告，不需要设置生效时间，保存立即生效，状态为1（生效）；

#### 广告池管理
1. 一个位置包含一个广告池，位置与广告池1对1关联；
2. 广告池用于存放定时投放的广告，按照广告的投放时间排序；
3. 广告池新增广告，与一般投放广告方式一样，保存状态为2（待投放）

#### 失效检测
1. 每个广告，分为按时间失效和按次数失效；
2. 按时间失效，满足条件==now>ended_at==则表示失效；
3. 按次数失效，曝光次数，或者点击次数到最大数，则失效；
4. 失效，标识为0；

#### 生效检测
1. 定时检测广告池的每个广告；
2. 广告满足条件==started_at<=now<=ended_at==，则检查，满足同一条件的广告位是否存在有效的广告，存在就不变，不存在就将此广告生效；


