# 多听FM3.0-榜单
### 对象之间关系
客户端接口`/homepage?type=`，通过type查询`PlatformPage` --> `Page`（页面） --> `PageColumn`（页面分栏） --> `PageContent`（分栏内容）

### 后台管理

* 榜单管理3.0
	* 	分栏管理（榜单页面的分栏，banner和榜单列表）
	*  榜单管理（榜单列表下的榜单，是榜单列表分栏内容点击之后的具体榜单）
	*  榜单上架，下架，删除
		* 下架，删除榜单下的内容 
		* 删除，删除榜单下的内容，同时删除榜单本身
	
#### 榜单分栏管理
1. banner分栏，同首页banner
2. 榜单分栏，分栏类型为：***左边图片+后边三行文字***，没有跳转类型

#### 榜单管理（榜单对象）
##### 概要设计
1. 页面操作：
选择一个榜单，进行`编辑榜单`操作，线上榜单下的内容，（如果榜单内容为空，则从定时榜单表中查询然后插入），可以对榜单内容进行排序。
2. 榜单定时器：
	1. 定时时间：
	2. 判断是否新的一天，新的一周，新的一月，分别更新日榜、周榜、月榜
	3. 执行定时器一次，需要将结果（榜单定时器表的记录）更新到对应的榜单内容表（根据榜单定时器表的排序算法，找到对应的榜单内容表）
	4. 手动定时，如果榜单定时器没有记录，进行手动执行
	
##### 编辑榜单的流程图
```flow
st=>start: Start:>http://www.google.com[blank]
e=>end:>http://www.google.com
op1=>operation: 编辑榜单
op2=>operation: 定时器更新榜单内容
cond=>condition: 榜单内容是否有记录

st->op1->cond
cond(yes)->e
cond(no)->op2->e
```


##### 榜单定时器更新榜单内容的流程图

```flow
st=>start: Start:>http://www.google.com[blank]
e=>end:>http://www.google.com
op1=>operation: 更新内容
op2=>operation: 更新榜单内容
op3=>operation: 根据算法删除榜单内容
cond=>condition: 是否删除

st->op1->cond
cond(yes)->op3->op2->e
cond(no)->op2->e
```
	
##### 数据库设计
1、榜单对象

属性 | 说明
------- | -------
 id| 主键
 rankType|	榜单分类（枚举：系统算法、自定义）
 rankContent|	榜单内容（枚举：节目、专辑、主播）
 rankOrder|	榜单排序算法（枚举：根据不同内容算法不一样）
 
 
 2、 榜单内容
 
 属性 | 说明
 ------- | -------
 id|主键
 rankId|榜单主键
 period|周期（日榜、周榜、月榜）
 itemId|类目主键（节目或专辑或主播的ID）
 itemTitle|类目标题（节目或专辑或主播的标题）
 finalOrder|最终排序（用户页面显示，后台人工可干预）
 systemOrder|算法排序（默认）
 isPin|是否人工干预
 pinNum|人工干预占位号码
 isCustomed|是否自定义
 
 
####  排序算法
##### 节目榜
* 收听榜：
	* 范围：
		* 日榜：昨天的收听历史
		* 周榜：上周的收听历史
		* 月榜：上月的收听历史
	* 算法：
		* 收听量从大到小 
* 热度榜
	* 范围：
		* 日榜：多维度的昨天的增量
		* 周榜：多维度的昨天的增量
		* 月榜：多维度的昨天的增量
 	* 算法：
 		* 多维度计算，收听量，评论数，点赞数

#####  		专辑榜
* 订阅榜
	* 范围
		* 日榜：昨天的订阅记录
		* 周榜：上周的订阅记录
		* 月榜：上月的订阅记录
	* 算法
		* 订阅量从大到小 
* 优质榜
	* 范围
		* 日榜：所有优质专辑
		* 周榜：所有优质专辑
		* 月榜：所有优质专辑
	* 算法 
		* 多维度计算
		
##### 主播榜
* 新晋主播
	* 范围：三个月内的新增主播
	* 算法：多维度计算
* 火热主播
	* 范围：所有主播
	* 算法：多维度计算
	*

#### 	疑问？
1. 各个热度榜的排序算法，有哪个维度，各占多少比重？
2. 热度榜的日榜，周榜，月榜的计算范围，是各个维度在周期内的增量？
3. 人工干预的深度多大？
	4. 在系统算法的排除的前50条中干预，还是系统算法有多少条都能干预，（如果算法有100条，都要在页面上干预？如果可以，节目热度榜上所有节目都可以干预？）
	5. 人工干预只能排顺序，还是能新增系统算法之外的内容？
6. 系统算法如果少于50条，如何？
7. 收听榜按每个周期的收听量排序？
8. 订阅榜按每个周期的订阅数排序？
9. 新晋主播的范围，三个月内（当前日期的前90天）的新主播？
10. 火热主播的范围，全部的主播？周期多久？
11. 人工干预的时间多久？只要标记了干预就能一直保持顺序，即使已经跌出了系统算法的榜单（范围上或者排序上），【**可以提供重新计算榜单的功能？**】跌出情况包括：
	1. 节目收听榜，一个周期的收听量跌出前50
	2. 节目热度榜，一个周期的热度增量跌出前50
	3. 专辑订阅榜，一个周期的订阅数跌出前50
	4. 专辑优质榜，已经不是优质专辑、一个周期的热度增量跌出前50
	5. 新晋主播榜，新增时间超过90天
	6. 火热主播榜，热度跌出前50

 
 


