# 定时推送修复
### 老逻辑出现的问题
* 未读的消息，再一个轮回还会推送
* 无网络的情况下，删除下载的专辑，还会推送，因为删除失败
* 卸载app，重装还能收到老app的下载推送，失效的mobileId和新的mobileId关联了同一个deviceToken，导致对下载的会收到幽灵信息，订阅、关注、评论、系统消息会收到双份信息
* 对同一个专辑，进行订阅、下载、关注收到重复的推送
* 自己回复自己的评论也有推送
* 退出登录还能收到订阅推送，退出失败？！因为推出之后有时候会将关联的userId设为0，或者删除失败的时候，还留着好信息，导致两个userId关联相同的mobileId，

### 需求
* 周一至周五17：00定时推送
* 下个轮回，老通知不推送（不管已读未读）
* 订阅通知 > 下载 > 关注，需要对同一个专辑的这三种情况做整合算法 ★
* 对失效的mobileId过滤，怎么找出失效的mobileId，只能说，两个mobileId关联同一个deviceToken，老的mobileId就是无效的。其他的无法判断
* 评论去除自己回复自己的评论

### 概要设计
* 三个定时器合成一个
* 专辑（符合条件） --> 订阅的userId，关注的userId
* userId --> mobileId，合并mobileId？？？？
* mobileId做过滤，deviceToken做过滤？？
* 最终，是一个deviceToken有几个album要推送，什么类型的推送，然后做过滤做合并，因为推送是指向deviceToken的
* 一个手机只有一个有效的mobileId，一个有效的deviceToken，所以deviceToken可以通过mobileId找到
* 过滤mobileId，哪些要过滤呢？
	*  如果是无效的mobileId
	*  一个mobileId有两个userId的时候

### 问题
因为数据，或者无网络bug，导致几个问题

* 几个userId关联相同mobileId
* 几个mobileId关联相同deviceToken

